@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@model Team

@{
    ViewData["Title"] = Model.Name;
}

<div class="container mt-4">
    <div class="row">
        <!-- Логотип и основная информация -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-body text-center">
                    @if (!string.IsNullOrEmpty(Model.Image))
                    {
                        <img src="@Model.Image" alt="@Model.Name" class="img-fluid rounded mb-3" style="max-height: 200px;">
                    }
                    else
                    {
                        <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
                             style="width: 200px; height: 200px;">
                            <i class="fas fa-users fa-4x text-muted"></i>
                        </div>
                    }

                    <h2 class="card-title">@Model.Name</h2>

                    @if (!string.IsNullOrEmpty(Model.Location))
                    {
                        <p class="text-muted">
                            <i class="fas fa-map-marker-alt"></i> @Model.Location
                        </p>
                    }

                    @if (Model.Category != null)
                    {
                        <span class="badge bg-primary fs-6 mb-2">@Model.Category.Name</span>
                    }

                    <!-- Кнопка "В избранное" -->
                    <!-- В представлении Details.cshtml, найдите форму -->
                    <form asp-controller="Favorites" asp-action="AddToFavorites" method="post" class="mt-3">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="teamId" value="@Model.Id" />
                        <button type="submit" class="btn btn-warning btn-lg w-100">
                            <i class="fas fa-star"></i>
                            @{
                                // Проверяем, есть ли уже в избранном
                                var session = Context.Session;
                                var favorites = session.Get<List<int>>("Favorites") ?? new List<int>();
                                if (favorites.Contains(Model.Id))
                                {
                                    <span>В избранном ✓</span>
                                }
                                else
                                {
                                    <span>В избранное</span>
                                }
                            }
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Детальная статистика -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0"><i class="fas fa-chart-line"></i> Детальная статистика</h4>
                </div>
                <div class="card-body">
                    <!-- Основные показатели -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="d-flex align-items-center mb-3">
                                <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3"
                                     style="width: 50px; height: 50px;">
                                    <i class="fas fa-trophy fa-lg"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block">Очки</small>
                                    <h3 class="mb-0">@Model.Points</h3>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="d-flex align-items-center mb-3">
                                <div class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center me-3"
                                     style="width: 50px; height: 50px;">
                                    <i class="fas fa-flag fa-lg"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block">Позиция</small>
                                    <h3 class="mb-0">#@Model.Position</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Статистика игр -->
                    <h5 class="border-bottom pb-2 mb-3">Результаты игр</h5>
                    <div class="row text-center mb-4">
                        <div class="col">
                            <div class="p-3 bg-success bg-opacity-10 rounded">
                                <div class="display-6 fw-bold text-success">@Model.Wins</div>
                                <small class="text-muted">Победы</small>
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-3 bg-warning bg-opacity-10 rounded">
                                <div class="display-6 fw-bold text-warning">@Model.Draws</div>
                                <small class="text-muted">Ничьи</small>
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-3 bg-danger bg-opacity-10 rounded">
                                <div class="display-6 fw-bold text-danger">@Model.Losses</div>
                                <small class="text-muted">Поражения</small>
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-3 bg-info bg-opacity-10 rounded">
                                <div class="display-6 fw-bold text-info">@(Model.Wins + Model.Draws + Model.Losses)</div>
                                <small class="text-muted">Всего игр</small>
                            </div>
                        </div>
                    </div>

                    <!-- Голы -->
                    <h5 class="border-bottom pb-2 mb-3">Голы</h5>
                    <div class="row text-center mb-4">
                        <div class="col">
                            <div class="p-3 bg-success bg-opacity-10 rounded">
                                <div class="display-6 fw-bold text-success">@Model.GoalsFor</div>
                                <small class="text-muted">Забито</small>
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-3 bg-danger bg-opacity-10 rounded">
                                <div class="display-6 fw-bold text-danger">@Model.GoalsAgainst</div>
                                <small class="text-muted">Пропущено</small>
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-3 bg-primary bg-opacity-10 rounded">
                                <div class="display-6 fw-bold text-primary">
                                    @(Model.GoalDifference > 0 ? "+" : "")@Model.GoalDifference
                                </div>
                                <small class="text-muted">Разница</small>
                            </div>
                        </div>
                    </div>

                    <!-- Процент побед -->
                    @{
                        var totalGames = Model.Wins + Model.Draws + Model.Losses;
                        var winPercentage = totalGames > 0 ? (double)Model.Wins / totalGames * 100 : 0;
                    }
                    <div class="mb-4">
                        <h5 class="border-bottom pb-2 mb-3">Процент побед</h5>
                        <div class="progress" style="height: 30px;">
                            <div class="progress-bar bg-success"
                                 role="progressbar"
                                 style="width: @winPercentage%"
                                 aria-valuenow="@winPercentage"
                                 aria-valuemin="0"
                                 aria-valuemax="100">
                                @winPercentage.ToString("F1")%
                            </div>
                        </div>
                    </div>

                    <!-- Дополнительная информация -->
                    <h5 class="border-bottom pb-2 mb-3">Дополнительная информация</h5>
                    <div class="row">
                        @if (!string.IsNullOrEmpty(Model.HeadCoach))
                        {
                            <div class="col-md-6 mb-2">
                                <strong>Тренер:</strong> @Model.HeadCoach
                            </div>
                        }

                        @if (!string.IsNullOrEmpty(Model.Captain))
                        {
                            <div class="col-md-6 mb-2">
                                <strong>Капитан:</strong> @Model.Captain
                            </div>
                        }

                        @if (!string.IsNullOrEmpty(Model.Stadium))
                        {
                            <div class="col-md-6 mb-2">
                                <strong>Стадион:</strong> @Model.Stadium
                            </div>
                        }

                        @if (Model.FoundedYear.HasValue)
                        {
                            <div class="col-md-6 mb-2">
                                <strong>Год основания:</strong> @Model.FoundedYear
                            </div>
                        }

                        @if (!string.IsNullOrEmpty(Model.Colors))
                        {
                            <div class="col-md-6 mb-2">
                                <strong>Цвета:</strong>
                                <div class="d-inline-flex gap-1 ms-2">
                                    @foreach (var color in Model.Colors.Split(',').Take(3))
                                    {
                                        <span class="color-circle" style="background-color: @color.Trim()"></span>
                                    }
                                </div>
                            </div>
                        }
                    </div>

                    <!-- Описание -->
                    @if (!string.IsNullOrEmpty(Model.Description))
                    {
                        <h5 class="border-bottom pb-2 mb-3 mt-4">О команде</h5>
                        <p>@Model.Description</p>
                    }
                </div>
            </div>

            <!-- Кнопки навигации -->
            <div class="mt-3">
                <a asp-action="Index" class="btn btn-outline-primary">
                    <i class="fas fa-arrow-left"></i> Назад к списку
                </a>
                <a asp-action="Statistics" asp-controller="Team" class="btn btn-primary ms-2">
                    <i class="fas fa-chart-bar"></i> Общая статистика
                </a>
            </div>
        </div>
    </div>
</div>

<style>
    .color-circle {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: inline-block;
        border: 2px solid #fff;
        box-shadow: 0 0 2px rgba(0,0,0,0.3);
    }

    .progress {
        border-radius: 15px;
        overflow: hidden;
    }

    .progress-bar {
        border-radius: 15px;
    }
</style>